<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
    /*! normalize.css v2.1.0 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 8/9.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 8/9.
 */

audio,
canvas,
video {
    display: inline-block;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 8/9.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    font-family: sans-serif; /* 1 */
    -webkit-text-size-adjust: 100%; /* 2 */
    -ms-text-size-adjust: 100%; /* 2 */
}

/**
 * Remove default margin.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address variable `h1` font-size and margin within `section` and `article`
 * contexts in Firefox 4+, Safari 5, and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

/**
 * Address styling not present in IE 8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Correct font family set oddly in Safari 5 and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre-wrap;
}

/**
 * Set consistent quote types.
 */

q {
    quotes: "\201C" "\201D" "\2018" "\2019";
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * Remove border when inside `a` element in IE 8/9.
 */

img {
    border: 0;
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 8/9 and Safari 5.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct `color` not being inherited in IE 8/9.
 * 2. Remove padding so people aren't caught out if they zero out fieldsets.
 */

legend {
    border: 0; /* 1 */
    padding: 0; /* 2 */
}

/**
 * 1. Correct font family not being inherited in all browsers.
 * 2. Correct font size not being inherited in all browsers.
 * 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome.
 */

button,
input,
select,
textarea {
    font-family: inherit; /* 1 */
    font-size: 100%; /* 2 */
    margin: 0; /* 3 */
}

/**
 * Address Firefox 4+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to `content-box` in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 4+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
@import url(http://fonts.googleapis.com/css?family=Open+Sans:400,700|Inconsolata:400,700);

html {
    margin: 0;
    padding: 0;
}

body {
    margin: 0 auto;
    padding: 0;
    width: 600px;
    font-family: 'Open Sans', sans-serif;
    font-size: 16px;
    line-height: 24px;
}

h1 {
    font-size: 32px;
    line-height: 48px;
    margin: 144px 0 24px 0;
}

h2 {
    font-size: 28px;
    line-height: 48px;
    margin: 0 0 24px 0;
}

h3 {
    font-size: 22px;
    line-height: 24px;
    margin: 48px 0 24px 0;
}

p, ul {
    margin: 0 0 24px 0;
}

ul ul {
    margin: 0 0 0 0;
}

pre {
    margin: 0 0 24px 0;
}

code {
    font-family: Inconsolata, monospace;
}

@media print {
    body {
        margin: 72px 72px;
    }
    @page {
        margin: 48px 48px;
    }
}

    </style>
</head>
<body>
    <h1>Yocto/Pathtrace: Tiny Path Tracer</h1>
<p>In this homework, you will learn how to build a simple path tracer with enough
features to make it robust for many scenes. In particular, you will learn how to</p>
<ul>
<li>write camera with depth of field,</li>
<li>write a complex material,</li>
<li>write a naive path tracer,</li>
<li>write a path tracer with multiple importance sampling.</li>
</ul>
<h2>Framework</h2>
<p>The code uses the library <a href="https://github.com/xelatihy/yocto-gl">Yocto/GL</a>,
that is included in this project in the directory <code>yocto</code>.
We suggest to consult the documentation for the library that you can find
at the beginning of the header files. Also, since the library is getting improved
during the duration of the course, se suggest that you star it and watch it
on Github, so that you can notified as improvements are made.</p>
<p>In order to compile the code, you have to install
<a href="https://apps.apple.com/it/app/xcode/id497799835?mt=12">Xcode</a>
on OsX, <a href="https://visualstudio.microsoft.com/it/vs/">Visual Studio 2019</a> on Windows,
or a modern version of gcc or clang on Linux,
together with the tools <a href="www.cmake.org">cmake</a> and <a href="https://ninja-build.org">ninja</a>.
The script <code>scripts/build.sh</code> will perform a simple build on OsX.
As discussed in class, we prefer to use
<a href="https://code.visualstudio.com">Visual Studio Code</a>, with
<a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++</a> and
<a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">CMake Tools</a>
extensions, that we have configured to use for this course.</p>
<p>You will write your code in the file <code>yocto_pathtrace.cpp</code> for functions that
are declared in <code>yocto_pathtrace.h</code>. Your renderer is callsed by <code>ypathtrace.cpp</code>
for a command-line interface and <code>yipathtraces.cpp</code> that show a simple
user interface.</p>
<p>This repository also contains tests that are executed from the command line
as shown in <code>run.sh</code>. The rendered images are saved in the <code>out/</code> directory.
The results should match the ones in the directory <code>check/</code>.</p>
<h2>Functionality (26 points)</h2>
<p>In this homework you will implement the following features:</p>
<ul>
<li><strong>Camera Sampling</strong> in functions <code>sample_camera()</code> and <code>eval_camera()</code>:<ul>
<li>implement camera sampling using <code>sample_disk()</code> for the lens</li>
<li>implement camera ray generation by simulating a thin lens camera</li>
<li>follow the slides to understand how to structure the code</li>
</ul>
</li>
<li><strong>Naive Path tracing</strong> in function <code>trace_naive()</code>:<ul>
<li>implement a naive path tracer using the product formulation</li>
<li>you should handle both delta and non-delta brdfs using <code>is_delta()</code>
  and the functions below</li>
<li>follow the slides to understand how to structure the code</li>
<li>you can use the functions <code>eval_position()</code>, <code>eval_shading_normal()</code>,
  <code>eval_emission()</code>, <code>eval_brdf()</code>, <code>eval_opacity()</code></li>
</ul>
</li>
<li><strong>Brdf sampling</strong> in function <code>eval_brdfcos()</code>, <code>sample_brdscos()</code>
  and <code>sample_brdfcos_pdf()</code>:<ul>
<li>implement brdf evaluation and sampling in the above functions</li>
<li>the brdf is a sum of the following lobes stored in a brdf objects<ul>
<li>diffuse lobe with weight <code>diffuse</code></li>
<li>specular lobe with weight <code>specular</code>, ior <code>ior</code>,
  and roughness <code>roughness</code></li>
<li>metal lobe with weight <code>metal</code>, complex ior <code>meta</code> and <code>metak</code>,
  and roughness <code>roughness</code></li>
<li>transmission lobe with weight <code>transmission</code>, ior <code>ior</code>,
  and roughness <code>roughness</code></li>
</ul>
</li>
<li>you can use all the reflectance functions in Yocto/Shading including <code>eval_&lt;lobe&gt;()</code>
  <code>sample_&lt;lobe&gt;()</code>, and <code>sample_&lt;lobe&gt;_pdf()</code> with lobes
  <code>&lt;func&gt;_diffuse_reflection()</code>, <code>&lt;func&gt;_microfacet_reflection()</code>,
  <code>&lt;func&gt;_microfacet_transmission()</code></li>
<li><code>eval_brdfcos()</code> is just a sum of lobes, but remember to fold in the cosine</li>
<li><code>sample_brdfcos()</code> picks a direction based on one of the lobes</li>
<li><code>sample_brdfcos_pdf()</code> is the sum of the PDFs using weights <code>&lt;lobe&gt;_pdf</code>
  stored in <code>brdf</code></li>
<li>follow the slides to understand how to structure the code</li>
</ul>
</li>
<li><strong>Delta handling</strong> in function <code>eval_delta()</code>, <code>sample_delta()</code> and <code>sample_delta_pdf()</code>:<ul>
<li>same as above with the corresponding functions</li>
<li>follow the slides to understand how to structure the code</li>
</ul>
</li>
<li><strong>Light sampling</strong> in function <code>sample_lights()</code> and <code>sample_lights_pdf()</code>:<ul>
<li>implement light sampling for both area lights and environment maps</li>
<li>lights and their CDFs are already implemented in <code>init_lights()</code></li>
<li>follow the slides to understand how to structure the code</li>
</ul>
</li>
<li><strong>Path tracing</strong> in function <code>trace_path()</code>:<ul>
<li>implement a path tracer in the product formulation that uses MIS for
  illumination of the smooth BRDFs</li>
<li>the simplest way here is to get naive path tracing to work,
  then cut&amp;paste that code and finally add light sampling using MIS</li>
<li>follow the slides to understand how to structure the code</li>
</ul>
</li>
</ul>
<p>To help out, we left example code in <code>trace_eyelight()</code>. You can also check out
Yocto/Trace that implements a similar path tracer; in this case though pay
attention to the various differences. In our opinion, it is probably easier to
follow the slides than to follow Yocto/Trace.</p>
<h2>Extra Credit (8 points)</h2>
<p>Here we put options of things you could try to do.
You do not have to do them all, since points are capped to 8.
Choose then ones you want to do. They are all fun!</p>
<ul>
<li><strong>Refraction</strong> in all BRDFs functions (2 points):<ul>
<li>use the functions in Yocto/Math that directly support refraction</li>
</ul>
</li>
<li><strong>Large Scenes</strong> (2 points):<ul>
<li>render the supplied large scenes at very high sampling rate to test your renderer</li>
</ul>
</li>
<li><strong>Denoising</strong> (6 points):<ul>
<li>add support for denoising using <a href="https://github.com/OpenImageDenoise/oidn">Intel Open Image Denoise</a></li>
<li>to do this, you need to export an image for the albedo and one for the normals,
  in additions to the rendered images</li>
<li>you can either modify your renderer to compute albedo and normals on the fly
  while rendering or write an albedo and normals shader</li>
<li>compile Intel OIDN on your machine</li>
<li>use the supplied example application to denoise your images</li>
<li>submit a comparison between noisy, denoised, and reference images</li>
</ul>
</li>
<li><strong>Stratified Sampling 1</strong> (4 points):<ul>
<li>implement startified sampling in a shader that only sendds rays out
  uniformly in the cosine-weghted hemisphere for environment maps with no recursion</li>
<li>compare this sampling to pure random sampling</li>
</ul>
</li>
<li><strong>Stratified Sampling 2</strong> (4 points):<ul>
<li>implement startified sampling to choose environment map pixels as in <a href="http://www.pbr-book.org">Pbrt</a></li>
<li>compare this sampling to pure random sampling</li>
</ul>
</li>
<li><strong>Implicit Surfaces</strong> (8 points):<ul>
<li>implement a raytracer for implicit surfaces as discussed in <a href="https://www.scratchapixel.com/lessons/advanced-rendering/rendering-distance-fields">Scratchapixel</a></li>
<li>you can either extend your path tracer with new shape types (we suggest this)
  or create a whole new renderer</li>
<li>implement a ray-implicit intersection</li>
<li>create a scene to demonstrate your findings; you can take the models from Shadertoy</li>
</ul>
</li>
<li><strong>MYOS</strong>, make your own scene (2 points):<ul>
<li>create additional scenes that you can render from models assembled by you</li>
<li>to create new scenes, you can directly edit the json files that are just
  a serialization of the same-name variables in Yocto/SceneIO</li>
<li>remember that to get proper lighting yoou should either use environment
  maps or emissive materials<ul>
<li>you can find high quality environment maps on <a href="https://hdrihaven.com">HDRIHaven</a></li>
</ul>
</li>
<li>as a starting point you could use one of the test scenes and put new objects and environments<ul>
<li>for material textures, try to search for "free PBR textures" on Google</li>
<li>for 3D models I am not sure; you can try either <a href="http://ccgtrader.com">CGTrader</a>, <a href="http://www.sketchfab.com">SketchFab</a>, <a href="https://3dmodelhaven.com">ModelHaven</a></li>
</ul>
</li>
<li>you could also try to edit a scene in Blender and export it in glTF, use ysceneproc from Yocto/GL to convert it and edit the resulting Json<ul>
<li>note though that in general lights and materials are not properly exported</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Submission</h2>
<p>To submit the homework, you need to pack a ZIP file that contains the code
you write and the images it generates, i.e. the ZIP <em>with only the
<code>yocto_pathtrace/</code> and <code>out/</code> directories</em>.
The file should be called <code>&lt;lastname&gt;_&lt;firstname&gt;_&lt;studentid&gt;.zip</code>
(<code>&lt;cognome&gt;_&lt;nome&gt;_&lt;matricola&gt;.zip</code>) and you should exclude
all other directories. Send it on Google Classroom.</p>
</body>
</html>
